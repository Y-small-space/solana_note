# 核心概念

## Solana 账户模型

在 Solana 上，所有数据都存储在所谓的“账户”中。Solana 上数据组织的方式类似于键值存储，其中数据库中的每个条目都称为“账户”。

## 关键点

- 账户最多可以存储 10MB 的数据，这些数据可以是可执行的程序代码或程序状态。
- 账户需要根据存储的数据量按比例支付 SOL 的租金押金，账户关闭时可全额退还。
- 每个账户都有一个程序“所有者”。只有拥有账户的程序可以修改其数据或扣减其 Lamport 余额。然而，任何人都可以增加余额。
- 程序（智能合约）是存储可执行代码的无状态账户。
- 数据账户由程序创建，用于存储和管理程序状态。
- 原生程序是 Solana 运行时中包含的内置程序。
- Sysvar 账户是存储网络集群状态的特殊账户。

## 账户

每个账户都有一个唯一的地址，表示为 32 字节的 Ed25519 公钥格式。可以将地址视为账户的唯一标识符。

### 账户地址

这种账户与地址之间的关系可以看作是键值对，其中地址作为键来定位账户的链上数据。

### 账户信息 (AccountInfo)

账户的最大大小为 10MB（10 兆字节），每个账户在 Solana 上存储的数据结构如下，称为 AccountInfo。

AccountInfo 包括以下字段：

- `data`：存储账户状态的字节数组。如果账户是一个程序（智能合约），则存储可执行程序代码。这个字段通常称为“账户数据”。
- `executable`：一个布尔标志，表示账户是否是程序。
- `lamports`：账户余额的数值表示，单位为 Lamports，SOL 的最小单位（1 SOL = 10 亿 Lamports）。
- `owner`：指定拥有账户的程序的公钥（程序 ID）。

在 Solana 账户模型中，每个账户都有一个指定的“所有者”，即一个程序。只有被指定为账户所有者的程序可以修改存储在账户中的数据或扣减账户的 Lamport 余额。需要注意的是，尽管只有所有者可以扣减余额，任何人都可以增加余额。

### 账户租金 (Rent)

要在链上存储数据，需要将一定数量的 SOL 转移到账户。转移的数量与账户中存储的数据大小成比例。这一概念通常称为“租金”。然而，可以将“租金”看作“押金”，因为分配给账户的 SOL 在账户关闭时可以全额退还。

## 原生程序 (Native Programs)

Solana 包含少量原生程序，这些程序是验证器实现的一部分，提供网络的各种核心功能。可以在此处找到原生程序的完整列表。

在 Solana 上开发自定义程序时，通常会与两个原生程序进行交互：系统程序和 BPF 加载器。

### 系统程序 (System Program)

默认情况下，所有新账户都归系统程序所有。系统程序执行几项关键任务，例如：

- 新账户创建：只有系统程序可以创建新账户。
- 空间分配：设置每个账户数据字段的字节容量。
- 分配程序所有权：系统程序创建账户后，可以将指定的程序所有者重新分配给其他程序账户。这是自定义程序如何接管由系统程序创建的新账户。

在 Solana 上，“钱包”只是一个归系统程序所有的账户。钱包的 Lamport 余额即账户拥有的 SOL 数量。

### BPF 加载器程序 (BPF Loader Program)

BPF 加载器是网络上所有其他程序（不包括原生程序）的所有者程序。它负责部署、升级和执行自定义程序。

### Sysvar 账户 (Sysvar Accounts)

Sysvar 账户是位于预定义地址的特殊账户，提供对集群状态数据的访问。这些账户会动态更新网络集群的数据。可以在此处找到 Sysvar 账户的完整列表。

## 自定义程序 (Custom Programs)

在 Solana 上，“智能合约”被称为程序。程序是包含可执行代码的账户，并且设置了“可执行”标志为 true。

有关程序部署过程的详细说明，请参阅本文档的“部署程序”页面。

### 程序账户 (Program Account)

在 Solana 上部署新程序时，技术上会创建三个独立的账户：

- 程序账户：代表链上程序的主要账户。此账户存储可执行数据账户的地址（存储编译的程序代码）和程序的更新权限（有权更改程序的地址）。
- 程序可执行数据账户：包含程序可执行字节代码的账户。
- 缓冲区账户：在程序正在积极部署或升级时存储字节代码的临时账户。一旦过程完成，数据将被转移到程序可执行数据账户，缓冲区账户将关闭。

### 数据账户 (Data Account)

Solana 程序是“无状态”的，这意味着程序账户只包含程序的可执行字节代码。为了存储和修改附加数据，必须创建新账户。这些账户通常被称为“数据账户”。

数据账户可以存储由所有者程序代码定义的任意数据。

需要注意的是，只有系统程序可以创建新账户。系统程序创建账户后，可以将新账户的所有权转移给其他程序。

换句话说，为自定义程序创建数据账户需要两个步骤：

1. 调用系统程序创建账户，然后将所有权转移给自定义程序。
2. 调用现在拥有账户的自定义程序，然后根据程序代码初始化账户数据。

尽管数据账户创建过程通常被抽象为一个步骤，但理解其底层过程是有帮助的。
